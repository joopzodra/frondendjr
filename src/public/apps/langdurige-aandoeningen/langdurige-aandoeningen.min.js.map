{"version":3,"sources":["src/langdurige-aandoeningen/langdurige-aandoeningen.ts"],"names":["viz","d3","select","cats","id","label","color","checked","append","attr","selectAll","data","enter","d","style","indexOf","html","margin","width","height","heightLarge","heightLargeTop","perc","format","years","timeYears","Date","x","scaleTime","domain","range","xAxis","axisBottom","tickSizeInner","tickSizeOuter","y_small","scaleLinear","y_large","yAxis_small","axisLeft","ticks","tickFormat","yAxis_large","line_small","line","i","y","line_large","csv","err","diseases","nest","key","entries","large","charts","call","each","selection","this","text","ageGroups","values","toLowerCase","classed","map","year","getFullYear","toString","replace","on","event","stopPropagation","ageGroup","button"],"mappings":"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","file":"langdurige-aandoeningen.min.js","sourcesContent":["interface IStringTMap<T> { [key: string]: T; }\ninterface IStringStringMap extends IStringTMap<string> { }\ninterface IKeyValuesObject { key: string, values: IStringStringMap[] }\ninterface IDataObject { key: string, values: IKeyValuesObject[] }\n\n(function() {\n\n  const viz = d3.select('#viz');\n\n  const cats = [\n    { id: 'totaal', label: 'alle leeftijden', color: '#1f77b4' },\n    { id: 'tot45', label: '35-45 jaar', color: '#ff7f0e' },\n    { id: 'tot55', label: '45-55 jaar', color: '#2ca02c' },\n    { id: 'tot65', label: '55-65 jaar', color: '#d62728' },\n    { id: 'tot75', label: '65-75 jaar', color: '#17becf' },\n    { id: 'boven75', label: 'ouder dan 75 jaar', color: '#8c564b' }\n  ]\n\n  //checked checkboxes on init\n  const checked = ['totaal', 'tot75', 'boven75'];\n\n  viz.append('div')\n    .attr('id', 'buttons')\n    .selectAll('button')\n    .data(cats)\n    .enter()\n    .append('button')\n    .attr('id', d => d.id)\n    .attr('class', 'w3-button w3-border')\n    .style('background-color', d => checked.indexOf(d.id) === -1 ? \"#fff\" : d.color)\n    .style('color', d => checked.indexOf(d.id) === -1 ? \"#000\" : \"#fff\")\n    .html(d => d.label);\n\n  const totalWidth = 300;\n  const totalHeight = 200;\n  const margin = { top: 60, right: 20, bottom: 20, left: 40 };\n  const width = totalWidth - margin.right - margin.left;\n  const height = totalHeight - margin.top - margin.bottom;\n  const heightLarge = 2 * totalHeight - margin.top - margin.bottom\n  const heightLargeTop = heightLarge - (0.5 / 0.25) * height //ratio is given by y_small scale and y_large scale ratio\n  const perc = d3.format('.0%');\n\n  const years = d3.timeYears(new Date(2001, 0, 1), new Date(2010, 0, 1));\n  const x = d3.scaleTime().domain([new Date(2000, 8, 1), new Date(2009, 3, 1)]).range([0, width]);\n  const xAxis = d3.axisBottom(x).tickSizeInner(6).tickSizeOuter(0);\n\n  const y_small = d3.scaleLinear().domain([0, 0.25]).range([height, 0]);\n  const y_large = d3.scaleLinear().domain([0, 0.5]).range([heightLarge, heightLargeTop]);\n  const yAxis_small = d3.axisLeft(y_small).ticks(5).tickFormat(perc);\n  const yAxis_large = d3.axisLeft(y_large).ticks(10).tickFormat(perc);\n\n  const line_small = d3.line().x((d, i) => x(years[i])).y(d => y_small(+d / 100));\n  const line_large = d3.line().x((d, i) => x(years[i])).y(d => y_large(+d / 100));\n\n  d3.csv('langdurige-aandoeningen.csv', (err, csv) => {\n    const diseases: IDataObject[] = d3.nest()\n      .key((d: IStringStringMap) => d['Aandoening'])\n      .key((d: IStringStringMap) => d['Leeftijd'])\n      .entries(csv);\n\n    const large = ['Hoge bloeddruk', 'Gewrichtsslijtage'];\n\n    const charts = viz.append('div')\n      .attr('id', 'charts')\n      .selectAll('.chart')\n      .data(diseases)\n      .enter()\n      .append('div')\n      .attr('class', 'chart')\n      .append('svg')\n      .attr('width', totalWidth)\n      .attr('height', d => large.indexOf(d.key) === -1 ? totalHeight : 2 * totalHeight)\n      .append('g')\n      .attr('id', (d, i) => 'disease' + i)\n      .attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n    charts.append('g')\n      .attr('class', 'x axis')\n      .attr(\"transform\", d => large.indexOf(d.key) === -1 ? `translate(0, ${height})` : `translate(0, ${heightLarge})`)\n      .call(xAxis);\n\n    charts.append('g')\n      .attr('class', 'y axis')\n      .each(yAxis);\n\n    function yAxis(selection: IDataObject) {\n      return large.indexOf(selection.key) === -1 ? d3.select(this).call(yAxis_small) : d3.select(this).call(yAxis_large)\n    }\n\n    //adding header to charts\n    charts.append(\"rect\")\n      .attr('x', 0)\n      .attr('y', d => large.indexOf(d.key) === -1 ? -18 : heightLargeTop - 18)\n      .attr('width', width)\n      .attr('height', 18)\n      .attr('class', 'textrect');\n\n    charts.append('text')\n      .attr('class', 'headtext')\n      .attr('transform', d => large.indexOf(d.key) === -1 ? `translate(5, -5)` : `translate(5, ${heightLargeTop - 5})`)\n      .text(d => d.key);\n\n    //containers for age groups\n    const ageGroups = charts.append('g')\n      .attr('class', 'lines')\n      .selectAll('g')\n      .data((d) => { return d.values })\n      .enter()\n      .append('g')\n      .attr('class', d => d.key.toLowerCase())\n      .classed('hidden', d => checked.indexOf(d.key.toLowerCase()) === -1)\n\n    ageGroups.append('path')\n      .attr('d', dAttr)\n      .attr('stroke', (d, i) => cats[i].color);\n\n    function dAttr(data: IKeyValuesObject) {\n      const values = data.values[0];\n      if (large.indexOf(values['Aandoening']) === -1) {\n        return line_small(<any>years.map(year => +values[year.getFullYear()]));\n      } else {\n        return line_large(<any>years.map(year => +values[year.getFullYear()]));\n      }\n    }\n\n    ageGroups.append('g')\n      .attr('class', 'numbers')\n      .selectAll('.number')\n      .data((d) => years.map(year => [d.values[0][year.getFullYear()], d.values[0]['Aandoening']])) //we need 'Aandoening' for attr y: y_small or y_large\n      .enter()\n      .append('text')\n      .attr('class', d => 'number')\n      .attr(\"x\", (d, i) => x(years[i]))\n      .attr(\"y\", d => large.indexOf(d[1]) === -1 ? y_small(+d[0] / 100) : y_large(+d[0] / 100))\n      .text(d => d[0].toString().replace(/\\./g, \",\"))\n      .attr(\"text-anchor\", \"middle\");\n\n    //rectangle covering whole charts to catch mouse events\n    charts.append('rect')\n      .attr('x', 0)\n      .attr('y', d => large.indexOf(d.key) === -1 ? 0 : heightLargeTop)\n      .attr('width', width)\n      .attr('height', d => large.indexOf(d.key) === -1 ? height : (0.5 / 0.25) * height)\n      .style(\"fill-opacity\", 0) //fill:hidden gives no mouse respond\n      .style(\"stroke-width\", 0)\n      .on('mouseover', (d, i) => {\n        d3.event.stopPropagation(); // to prevent triggering the listener on the body element\n        d3.select('#disease' + i).selectAll('.numbers').classed('visible', true)\n      })\n      .on('mouseout', (d, i) => {\n        d3.select('#disease' + i).selectAll('.numbers').classed('visible', false);\n      });\n\n    d3.select('#viz')\n      .on('mouseover', () => d3.selectAll('.numbers').classed('visible', false));\n\n  });\n\n  d3.selectAll('button')\n    .on('click', function(d: IStringStringMap) {\n      d3.event.stopPropagation();\n      const ageGroup = d3.selectAll('.' + d.id);\n      const button = d3.select(this);\n      if (ageGroup.classed('hidden')) {\n        ageGroup.classed('hidden', false);\n        button.style('background-color', d.color, 'important')\n          .style('color', '#fff', 'important');\n      } else {\n        ageGroup.classed('hidden', true);\n        button.style('background-color', '#fff', 'important')\n          .style('color', '#000', 'important');\n      }\n    });\n\n})()\n"]}